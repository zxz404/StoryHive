/*! For license information please see 350.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkapp_starter_project_with_webpack=self.webpackChunkapp_starter_project_with_webpack||[]).push([[350],{146:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}n.d(t,{A:()=>o});const o=function(){return e=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.containerId=t,this.options=n,this.map=null,this.markers={},this.activeMarker=null,this.tileLayers={},this.init()},t=[{key:"init",value:function(){this.map=L.map(this.containerId,{center:this.options.center||[-6.2088,106.8456],zoom:this.options.zoom||10,zoomControl:!1}),L.control.zoom({position:"bottomright"}).addTo(this.map),this.setupTileLayers(),this.setupLayerControl()}},{key:"setupTileLayers",value:function(){this.tileLayers.openstreetmap=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap contributors",maxZoom:19}),this.tileLayers.satellite=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",maxZoom:19}),this.tileLayers.openstreetmap.addTo(this.map),this.currentTileLayer="openstreetmap"}},{key:"setupLayerControl",value:function(){this.layerControl=L.control.layers(this.tileLayers).addTo(this.map)}},{key:"addMarker",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=L.marker([e.lat,e.lon],{title:e.name}),r='\n            <div class="story-popup">\n                <img src="'.concat(e.photoUrl,'" alt="').concat(e.description,'" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;">\n                <div style="margin-top: 8px;">\n                    <strong>').concat(e.name,'</strong>\n                    <p style="margin: 4px 0; font-size: 0.9em;">').concat(e.description,'</p>\n                    <small style="color: #666;">').concat(new Date(e.createdAt).toLocaleDateString("id-ID"),"</small>\n                </div>\n            </div>\n        ");return n.bindPopup(r),n.addTo(this.map),this.markers[e.id]=n,t.onClick&&n.on("click",(function(){return t.onClick(e)})),n}},{key:"removeMarker",value:function(e){this.markers[e]&&(this.map.removeLayer(this.markers[e]),delete this.markers[e])}},{key:"clearMarkers",value:function(){var e=this;Object.values(this.markers).forEach((function(t){e.map.removeLayer(t)})),this.markers={}}},{key:"setActiveMarker",value:function(e){this.activeMarker&&this.markers[this.activeMarker]&&this.markers[this.activeMarker].setIcon(this.getDefaultIcon()),this.markers[e]&&(this.markers[e].setIcon(this.getActiveIcon()),this.activeMarker=e,this.map.panTo(this.markers[e].getLatLng()),this.markers[e].openPopup())}},{key:"getDefaultIcon",value:function(){return L.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})}},{key:"getActiveIcon",value:function(){return L.icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})}},{key:"onMapClick",value:function(e){this.map.on("click",(function(t){e(t.latlng.lat,t.latlng.lng)}))}},{key:"setView",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;this.map.setView([e,t],n)}},{key:"destroy",value:function(){this.map&&(this.map.remove(),this.map=null)}}],t&&i(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}()},350:(e,t,n)=>{n.r(t),n.d(t,{AddSPg:()=>k});var r=n(146),i=n(775);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(){var e=h(),t=e.m(o),n=(Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__).constructor;function r(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===n||"GeneratorFunction"===(t.displayName||t.name))}var i={throw:1,return:2,break:3,continue:3};function a(e){var t,n;return function(r){t||(t={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(e,t){return n(r.a,i[e],t)},delegateYield:function(e,i,a){return t.resultName=i,n(r.d,s(e),a)},finish:function(e){return n(r.f,e)}},n=function(e,n,i){r.p=t.prev,r.n=t.next;try{return e(n,i)}finally{t.next=r.n}}),t.resultName&&(t[t.resultName]=r.v,t.resultName=void 0),t.sent=r.v,t.next=r.n;try{return e.call(this,t)}finally{r.p=t.prev,r.n=t.next}}}return(o=function(){return{wrap:function(t,n,r,i){return e.w(a(t),n,r,i&&i.reverse())},isGeneratorFunction:r,mark:e.m,awrap:function(e,t){return new p(e,t)},AsyncIterator:d,async:function(e,t,n,i,o){return(r(t)?u:l)(a(e),t,n,i,o)},keys:c,values:s}})()}function s(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(a(e)+" is not iterable")}function c(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}}function l(e,t,n,r,i){var a=u(e,t,n,r,i);return a.next().then((function(e){return e.done?e.value:a.next()}))}function u(e,t,n,r,i){return new d(h().w(e,t,n,r),i||Promise)}function d(e,t){function n(r,i,a,o){try{var s=e[r](i),c=s.value;return c instanceof p?t.resolve(c.v).then((function(e){n("next",e,a,o)}),(function(e){n("throw",e,a,o)})):t.resolve(c).then((function(e){s.value=e,a(s)}),(function(e){return n("throw",e,a,o)}))}catch(e){o(e)}}var r;this.next||(m(d.prototype),m(d.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),m(this,"_invoke",(function(e,i,a){function o(){return new t((function(t,r){n(e,a,t,r)}))}return r=r?r.then(o,o):o()}),!0)}function h(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return m(l,"_invoke",function(n,r,i){var a,s,c,l=0,u=i||[],d=!1,h={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,s=0,c=e,h.n=n,o}};function m(n,r){for(s=n,c=r,t=0;!d&&l&&!i&&t<u.length;t++){var i,a=u[t],m=h.p,p=a[2];n>3?(i=p===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=m&&((i=n<2&&m<a[1])?(s=0,h.v=r,h.n=a[1]):m<p&&(i=n<3||a[0]>r||r>p)&&(a[4]=n,a[5]=r,h.n=p,s=0))}if(i||n>1)return o;throw d=!0,r}return function(i,u,p){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,p),s=u,c=p;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(h.n=-1),m(s,c)):h.n=c:h.v=c);try{if(l=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(d=h.n<0)?c:n.call(r,h))!==o)break}catch(t){a=e,s=1,c=t}finally{l=1}}return{value:t,done:d}}}(n,i,a),!0),l}var o={};function s(){}function c(){}function l(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(m(t={},r,(function(){return this})),t),d=l.prototype=s.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,m(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=l,m(d,"constructor",l),m(l,"constructor",c),c.displayName="GeneratorFunction",m(l,i,"GeneratorFunction"),m(d),m(d,i,"Generator"),m(d,r,(function(){return this})),m(d,"toString",(function(){return"[object Generator]"})),(h=function(){return{w:a,m:p}})()}function m(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}m=function(e,t,n,r){function a(t,n){m(e,t,(function(e){return this._invoke(t,n,e)}))}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},m(e,t,n,r)}function p(e,t){this.v=e,this.k=t}function v(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){v(a,r,i,o,s,"next",e)}function s(e){v(a,r,i,o,s,"throw",e)}o(void 0)}))}}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,b(r.key),r)}}function b(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}var k=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=this.createView(),this.mapManager=null,this.mediaStream=null,this.currentLat=null,this.currentLon=null,this.selectionMarker=null,this.currentPhoto=null},t=[{key:"createView",value:function(){var e=document.createElement("section");return e.className="pg add-s-pg",e.innerHTML='\n            <div class="add-s-cntnr">\n                <header class="sh-pg-hdr">\n                    <h2>Bagikan Cerita Anda</h2>\n                    <p>Isi form di bawah untuk berbagi pengalaman menarik dengan komunitas</p>\n                </header>\n\n                <form id="add-s-frm" class="s-frm" novalidate>\n                    <div class="frm-grid">\n                        <section class="frm-sec frm-sec--photo" aria-labelledby="photo-sec-title">\n                            <h3 id="photo-sec-title">Foto Cerita</h3>\n                            \n                            <div class="upl-cntnr">\n                                <div class="upl-opts">\n                                    <button type="button" id="upload-btn" class="upl-opt-btn is-active">\n                                        üìÅ Upload File\n                                    </button>\n                                    <button type="button" id="camera-btn" class="upl-opt-btn">\n                                         Ambil Foto\n                                    </button>\n                                </div>\n\n                                <div id="file-upload-sec" class="upl-sec">\n                                    <div class="upl-area" id="file-upl-area">\n                                        <div class="upl-placeholder">\n                                            <span class="upl-icon">üìÅ</span>\n                                            <p>Klik untuk memilih foto atau drag & drop di sini</p>\n                                            <small>Format: JPG, PNG, GIF (Maks. 5MB)</small>\n                                        </div>\n                                        <input \n                                            type="file" \n                                            id="photo-input" \n                                            name="photo" \n                                            accept="image/*" \n                                            class="is-visually-hidden"\n                                            aria-describedby="photo-error"\n                                        >\n                                    </div>\n                                    <div class="prv-cntnr is-hidden" id="file-prv">\n                                        <img id="file-prv-img" alt="Preview foto yang diupload">\n                                        <button type="button" id="remove-file-btn" class="btn-remove" aria-label="Hapus foto">\n                                            √ó\n                                        </button>\n                                    </div>\n                                </div>\n\n                                <div id="camera-sec" class="upl-sec is-hidden">\n                                    <div class="cam-cntnr">\n                                        <video id="camera-preview" autoplay muted playsinline \n                                               aria-label="Preview kamera untuk mengambil foto"></video>\n                                        <div class="cam-ctrl">\n                                            <button type="button" id="cam-capture-btn" class="btn-primary">\n                                                 Ambil Foto\n                                            </button>\n                                            <button type="button" id="cam-switch-btn" class="btn-secondary">\n                                                 Switch Kamera\n                                            </button>\n                                            <button type="button" id="cam-close-btn" class="btn-secondary">\n                                                 Tutup Kamera\n                                            </button>\n                                        </div>\n                                    </div>\n                                    <div class="prv-cntnr is-hidden" id="camera-prv-result">\n                                        <img id="camera-prv-img" alt="Preview foto dari kamera">\n                                        <div class="cam-prv-ctrl">\n                                            <button type="button" id="cam-retake-btn" class="btn-secondary">\n                                                 Ambil Ulang\n                                            </button>\n                                            <button type="button" id="cam-use-btn" class="btn-primary">\n                                                 Gunakan Foto Ini\n                                            </button>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div id="photo-error" class="error-msg is-hidden" role="alert"></div>\n                            </div>\n                        </section>\n\n                        <section class="frm-sec frm-sec--details" aria-labelledby="details-sec-title">\n                            <h3 id="details-sec-title">Detail Cerita</h3>\n\n                            <div class="frm-group">\n                                <label for="description-input" class="is-required">Deskripsi Cerita</label>\n                                <textarea \n                                    id="description-input" \n                                    name="description" \n                                    required \n                                    rows="5"\n                                    aria-describedby="description-error description-help"\n                                    placeholder="Ceritakan pengalaman menarik Anda..."\n                                    aria-required="true"\n                                ></textarea>\n                                <div class="char-count" id="description-help">\n                                    <span id="char-count">0</span>/1000 karakter\n                                </div>\n                                <div id="description-error" class="error-msg is-hidden" role="alert"></div>\n                            </div>\n                        </section>\n\n                        <section class="frm-sec frm-sec--location" aria-labelledby="location-sec-title">\n                            <h3 id="location-sec-title">Lokasi</h3>\n                            <p class="sec-desc">Klik pada peta di bawah untuk memilih lokasi cerita Anda</p>\n\n                            <div class="loc-info">\n                                <div class="coord-display">\n                                    <div class="coord">\n                                        <label for="latitude-display">Latitude:</label>\n                                        <span id="latitude-display" aria-live="polite">-</span>\n                                    </div>\n                                    <div class="coord">\n                                        <label for="longitude-display">Longitude:</label>\n                                        <span id="longitude-display" aria-live="polite">-</span>\n                                    </div>\n                                </div>\n                                <button type="button" id="btn-cur-loc" class="btn-secondary">\n                                    üìç Gunakan Lokasi Saya\n                                </button>\n                            </div>\n\n                            <div class="map-small-cntnr">\n                                <div id="location-map" class="map-small" \n                                     aria-label="Peta interaktif untuk memilih lokasi cerita"\n                                     role="application"\n                                     tabindex="0">\n                                </div>\n                                <div class="map-instruction">Klik pada peta untuk memilih lokasi</div>\n                            </div>\n                            <div id="location-error" class="error-msg is-hidden" role="alert"></div>\n                        </section>\n                    </div>\n\n                    <div id="general-error" class="error-msg is-hidden" role="alert"></div>\n\n                    <div class="frm-act">\n                        <button type="button" id="btn-cancel" class="btn-secondary">Batal</button>\n                        <button type="submit" id="btn-submit" class="btn-primary" disabled>Bagikan Cerita</button>\n                    </div>\n                </form>\n\n                <div id="success-mdl" class="mdl is-hidden" role="dialog" aria-labelledby="success-mdl-title">\n                    <div class="mdl-cnt">\n                        <div class="mdl-icon success-anim">\n                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">\n                                <circle cx="40" cy="40" r="38" stroke="#10B981" stroke-width="4" fill="none" class="anim-circle"/>\n                                <path d="M56 34L36 54L24 42" stroke="#10B981" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" class="anim-check"/>\n                            </svg>\n                        </div>\n                        <h3 id="success-mdl-title">Cerita Berhasil Dibagikan!</h3>\n                        <p>Terima kasih telah berbagi pengalaman dengan komunitas.</p>\n                        <div class="mdl-act">\n                            <button id="btn-home" class="btn-primary">Kembali ke Beranda</button>\n                            <button id="btn-add" class="btn-secondary">Tambah Cerita Lain</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ',e}},{key:"init",value:(d=f(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.initializeMap();case 3:this.setupEventHandlers(),this.setupFormValidation(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.showError("general","Gagal memuat halaman: "+e.t0.message);case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return d.apply(this,arguments)})},{key:"initializeMap",value:(u=f(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e){return setTimeout(e,100)}));case 3:this.mapManager=new r.A("location-map",{center:[-6.2088,106.8456],zoom:10}),this.mapManager.onMapClick((function(e,n){t.handleLocationSelect(e,n)})),this.mapManager.map.on("click",(function(e){t.addSelectionMarker(e.latlng)})),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Gagal menginisialisasi peta:",e.t0),this.showError("general","Gagal memuat peta. Silakan refresh halaman.");case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return u.apply(this,arguments)})},{key:"setupEventHandlers",value:function(){this.bindFileUpload(),this.bindCameraToggle(),this.bindCameraCapture(),this.bindFormSubmit(),this.bindFormCancel(),this.bindCurrentLocation(),this.bindModalActions()}},{key:"setupFormValidation",value:function(){this.bindInputValidation()}},{key:"bindFileUpload",value:function(){var e=this,t=this.element.querySelector("#photo-input"),n=this.element.querySelector("#file-upl-area"),r=this.element.querySelector("#file-prv"),i=this.element.querySelector("#remove-file-btn");n.addEventListener("click",(function(){t.click()})),n.addEventListener("dragover",(function(e){e.preventDefault(),n.classList.add("is-drag-over")})),n.addEventListener("dragleave",(function(){n.classList.remove("is-drag-over")})),n.addEventListener("drop",(function(t){t.preventDefault(),n.classList.remove("is-drag-over");var r=t.dataTransfer.files;r.length>0&&e.handleFileUpload(r[0])})),t.addEventListener("change",(function(t){t.target.files.length>0&&e.handleFileUpload(t.target.files[0])})),i.addEventListener("click",(function(){t.value="",r.classList.add("is-hidden"),e.element.querySelector("#file-upl-area").classList.remove("is-hidden"),e.handleFileUpload(null)}))}},{key:"handleFileUpload",value:function(e){e&&this.validatePhoto(e)?(this.currentPhoto=e,this.displayFilePreview(e)):this.currentPhoto=null,this.updateSubmitButton()}},{key:"displayFilePreview",value:function(e){var t=this.element.querySelector("#file-prv"),n=this.element.querySelector("#file-prv-img"),r=this.element.querySelector("#file-upl-area"),i=new FileReader;i.onload=function(e){n.src=e.target.result,t.classList.remove("is-hidden"),r.classList.add("is-hidden")},i.readAsDataURL(e)}},{key:"bindCameraToggle",value:function(){var e=this,t=this.element.querySelector("#upload-btn"),n=this.element.querySelector("#camera-btn"),r=this.element.querySelector("#file-upload-sec"),i=this.element.querySelector("#camera-sec"),a=this.element.querySelector("#cam-close-btn");t.addEventListener("click",(function(){t.classList.add("is-active"),n.classList.remove("is-active"),r.classList.remove("is-hidden"),i.classList.add("is-hidden"),e.stopCamera(),e.resetCameraPreview()})),n.addEventListener("click",(function(){n.classList.add("is-active"),t.classList.remove("is-active"),i.classList.remove("is-hidden"),r.classList.add("is-hidden"),e.startCamera()})),a.addEventListener("click",(function(){e.stopCamera(),t.classList.add("is-active"),n.classList.remove("is-active"),r.classList.remove("is-hidden"),i.classList.add("is-hidden"),e.resetCameraPreview()}))}},{key:"startCamera",value:(l=f(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}},e.next=4,navigator.mediaDevices.getUserMedia(t);case 4:this.mediaStream=e.sent,this.element.querySelector("#camera-preview").srcObject=this.mediaStream,e.next=14;break;case 9:e.prev=9,e.t0=e.catch(0),this.showError("photo","Tidak dapat mengakses kamera."),this.element.querySelector("#upload-btn").click();case 14:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(){return l.apply(this,arguments)})},{key:"stopCamera",value:function(){this.mediaStream&&(this.mediaStream.getTracks().forEach((function(e){return e.stop()})),this.mediaStream=null);var e=this.element.querySelector("#camera-preview");e&&(e.srcObject=null)}},{key:"bindCameraCapture",value:function(){var e=this,t=this.element.querySelector("#cam-capture-btn"),n=this.element.querySelector("#cam-switch-btn"),r=this.element.querySelector("#cam-retake-btn"),i=this.element.querySelector("#cam-use-btn"),a=this.element.querySelector("#camera-prv-result"),s=this.element.querySelector("#camera-prv-img");t.addEventListener("click",(function(){var t=e.element.querySelector("#camera-preview"),n=document.createElement("canvas"),r=n.getContext("2d");n.width=t.videoWidth,n.height=t.videoHeight,r.drawImage(t,0,0),n.toBlob((function(t){if(t){var n=new File([t],"camera-capture.jpg",{type:"image/jpeg"});e.handleCameraCapture(n),s.src&&s.src.startsWith("blob:")&&URL.revokeObjectURL(s.src);var r=URL.createObjectURL(t);s.src=r,a.classList.remove("is-hidden"),e.element.querySelector(".cam-cntnr").classList.add("is-hidden")}else console.error("Failed to capture image")}),"image/jpeg",.8)})),i.addEventListener("click",(function(){e.stopCamera()})),n.addEventListener("click",f(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.switchCamera();case 2:case"end":return t.stop()}}),t)})))),r.addEventListener("click",(function(){s.src&&s.src.startsWith("blob:")&&(URL.revokeObjectURL(s.src),s.src=""),a.classList.add("is-hidden"),e.element.querySelector(".cam-cntnr").classList.remove("is-hidden"),e.handleCameraCapture(null),e.mediaStream||e.startCamera()}))}},{key:"resetCameraPreview",value:function(){var e=this.element.querySelector("#camera-prv-result"),t=this.element.querySelector("#camera-prv-img"),n=this.element.querySelector(".cam-cntnr");e.classList.add("is-hidden"),n.classList.remove("is-hidden"),t.src&&t.src.startsWith("blob:")&&(URL.revokeObjectURL(t.src),t.src=""),this.handleCameraCapture(null)}},{key:"switchCamera",value:(c=f(o().mark((function e(){var t,n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopCamera(),n=null===(t=this.mediaStream)||void 0===t||null===(t=t.getVideoTracks()[0])||void 0===t?void 0:t.getSettings().facingMode,r="user"===n?"environment":"user",e.prev=3,i={video:{facingMode:r,width:{ideal:1280},height:{ideal:720}}},e.next=7,navigator.mediaDevices.getUserMedia(i);case 7:this.mediaStream=e.sent,this.element.querySelector("#camera-preview").srcObject=this.mediaStream,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),this.showError("photo","Tidak dapat mengganti kamera.");case 15:case"end":return e.stop()}}),e,this,[[3,12]])}))),function(){return c.apply(this,arguments)})},{key:"handleCameraCapture",value:function(e){if(e)if(this.validatePhoto(e)){this.currentPhoto=e;var t=this.element.querySelector("#photo-input"),n=new DataTransfer;n.items.add(e),t.files=n.files}else this.currentPhoto=null;else this.currentPhoto=null;this.updateSubmitButton()}},{key:"bindFormSubmit",value:function(){var e=this;this.element.querySelector("#add-s-frm").addEventListener("submit",function(){var t=f(o().mark((function t(n){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.next=3,e.handleFormSubmit();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"bindFormCancel",value:function(){this.element.querySelector("#btn-cancel").addEventListener("click",(function(){confirm("Apakah Anda yakin ingin membatalkan? Data yang sudah diisi akan hilang.")&&(window.location.hash="#/home")}))}},{key:"bindInputValidation",value:function(){var e=this,t=this.element.querySelector("#description-input"),n=this.element.querySelector("#char-count");t.addEventListener("input",(function(){var r=t.value.length;n.textContent=r,r>1e3&&(t.value=t.value.substring(0,1e3),n.textContent=1e3),e.validateDescription(),e.updateSubmitButton()}))}},{key:"validateDescription",value:function(){var e=this.element.querySelector("#description-input").value.trim();return e?e.length<10?(this.showError("description","Deskripsi minimal 10 karakter"),!1):(this.hideError("description"),!0):(this.showError("description","Deskripsi wajib diisi"),!1)}},{key:"validatePhoto",value:function(e){return e?e.size>5242880?(this.showError("photo","Ukuran foto maksimal 5MB"),!1):["image/jpeg","image/png","image/gif"].includes(e.type)?(this.hideError("photo"),!0):(this.showError("photo","Format file harus JPG, PNG, atau GIF"),!1):(this.showError("photo","Foto wajib diisi"),!1)}},{key:"validateLocation",value:function(e,t){return e&&t?(this.hideError("location"),!0):(this.showError("location","Silakan pilih lokasi pada peta"),!1)}},{key:"showError",value:function(e,t){var n=this.element.querySelector("#".concat(e,"-error"));if(n){n.textContent=t,n.classList.remove("is-hidden");var r=this.element.querySelector("#".concat(e,"-input"))||this.element.querySelector("#".concat(e,"-upl-area"));r&&r.classList.add("has-error")}}},{key:"hideError",value:function(e){var t=this.element.querySelector("#".concat(e,"-error"));if(t){t.classList.add("is-hidden");var n=this.element.querySelector("#".concat(e,"-input"))||this.element.querySelector("#".concat(e,"-upl-area"));n&&n.classList.remove("has-error")}}},{key:"updateSubmitButton",value:function(){var e=this.element.querySelector("#btn-submit"),t=this.validateDescription(),n=null!==this.currentPhoto,r=null!==this.currentLat&&null!==this.currentLon;e.disabled=!(t&&n&&r)}},{key:"handleFormSubmit",value:(s=f(o().mark((function e(){var t,n,r,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.validateDescription(),n=this.validatePhoto(this.currentPhoto),r=this.validateLocation(this.currentLat,this.currentLon),t&&n&&r){e.next=6;break}return this.showError("general","Harap perbaiki error pada form sebelum mengirim"),e.abrupt("return");case 6:return this.hideError("general"),e.prev=7,this.showLoading(),e.next=11,this.compressImage(this.currentPhoto);case 11:return a=e.sent,s={description:this.element.querySelector("#description-input").value.trim(),photo:a,lat:this.currentLat,lon:this.currentLon},e.next=15,i.default.addStory(s);case 15:this.hideLoading(),this.showSuccessModal(),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(7),this.hideLoading(),this.handleSubmissionError(e.t0);case 23:case"end":return e.stop()}}),e,this,[[7,19]])}))),function(){return s.apply(this,arguments)})},{key:"compressImage",value:(a=f(o().mark((function e(t){var n,r,i=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:800,r=i.length>2&&void 0!==i[2]?i[2]:.7,e.abrupt("return",new Promise((function(e,i){var a=document.createElement("canvas"),o=a.getContext("2d"),s=new Image;s.onload=function(){var c=s.width,l=s.height;c>n&&(l=l*n/c,c=n),a.width=c,a.height=l,o.drawImage(s,0,0,c,l),a.toBlob((function(n){if(n){var r=new File([n],t.name,{type:"image/jpeg",lastModified:Date.now()});console.log("Ukuran asli: ".concat((t.size/1024/1024).toFixed(2),"MB")),console.log("Ukuran setelah kompresi: ".concat((r.size/1024/1024).toFixed(2),"MB")),e(r)}else i(new Error("Gagal mengkompresi gambar"))}),"image/jpeg",r)},s.onerror=function(){i(new Error("Gagal memuat gambar"))};var c=new FileReader;c.onload=function(e){s.src=e.target.result},c.onerror=function(){i(new Error("Gagal membaca file"))},c.readAsDataURL(t)})));case 3:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"handleLocationSelect",value:function(e,t){this.setSelectedLocation(e,t),this.addSelectionMarker({lat:e,lng:t})}},{key:"setSelectedLocation",value:function(e,t){this.currentLat=e,this.currentLon=t;var n=this.element.querySelector("#latitude-display"),r=this.element.querySelector("#longitude-display");n.textContent=e.toFixed(6),r.textContent=t.toFixed(6),this.validateLocation(e,t),this.updateSubmitButton()}},{key:"addSelectionMarker",value:function(e){this.mapManager&&this.mapManager.map?(this.selectionMarker&&this.mapManager.map.removeLayer(this.selectionMarker),this.selectionMarker=L.marker(e,{icon:L.icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})}).addTo(this.mapManager.map),this.mapManager.map.panTo(e)):console.warn("Map manager belum siap")}},{key:"bindCurrentLocation",value:function(){var e=this;this.element.querySelector("#btn-cur-loc").addEventListener("click",(function(){e.handleCurrentLocation()}))}},{key:"handleCurrentLocation",value:(n=f(o().mark((function e(){var t,n,r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.geolocation){e.next=3;break}return this.showError("location","Browser tidak mendukung geolocation"),e.abrupt("return");case 3:return e.prev=3,e.next=6,new Promise((function(e,t){navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}));case 6:t=e.sent,n=t.coords,r=n.latitude,i=n.longitude,this.handleLocationSelect(r,i),this.mapManager&&this.mapManager.map&&this.mapManager.setView(r,i,15),e.next=27;break;case 12:e.prev=12,e.t0=e.catch(3),a="Tidak dapat mendapatkan lokasi saat ini. ",e.t1=e.t0.code,e.next=e.t1===e.t0.PERMISSION_DENIED?18:e.t1===e.t0.POSITION_UNAVAILABLE?20:e.t1===e.t0.TIMEOUT?22:24;break;case 18:return a+="Izin lokasi ditolak.",e.abrupt("break",26);case 20:return a+="Informasi lokasi tidak tersedia.",e.abrupt("break",26);case 22:return a+="Permintaan lokasi timeout.",e.abrupt("break",26);case 24:return a+="Terjadi kesalahan yang tidak diketahui.",e.abrupt("break",26);case 26:this.showError("location",a);case 27:case"end":return e.stop()}}),e,this,[[3,12]])}))),function(){return n.apply(this,arguments)})},{key:"bindModalActions",value:function(){var e=this,t=this.element.querySelector("#btn-home"),n=this.element.querySelector("#btn-add");t.addEventListener("click",(function(){return e.handleModalAction("home")})),n.addEventListener("click",(function(){return e.handleModalAction("add-another")}))}},{key:"handleModalAction",value:function(e){this.hideSuccessModal(),"home"===e?window.location.hash="#/home":"add-another"===e&&(this.resetForm(),this.cleanupSelectionMarker(),this.element.querySelector("#upload-btn").click(),this.element.scrollIntoView({behavior:"smooth",block:"start"}))}},{key:"showSuccessModal",value:function(){var e=this.element.querySelector("#success-mdl");e.classList.remove("is-hidden"),e.setAttribute("aria-hidden","false"),this.element.querySelector("#btn-home").focus()}},{key:"hideSuccessModal",value:function(){var e=this.element.querySelector("#success-mdl");e.classList.add("is-hidden"),e.setAttribute("aria-hidden","true")}},{key:"showLoading",value:function(){var e=this.element.querySelector("#btn-submit");e.disabled=!0,e.innerHTML='<div class="loading-spinner"></div> Mengunggah...'}},{key:"hideLoading",value:function(){var e=this.element.querySelector("#btn-submit");e.disabled=!1,e.textContent="Bagikan Cerita"}},{key:"handleSubmissionError",value:function(e){var t="Gagal mengirim cerita. ";e.message.includes("network")||!navigator.onLine?t+="Periksa koneksi internet Anda.":e.message.includes("size")||e.message.includes("1000000")?t+="Ukuran foto terlalu besar. Coba gunakan foto dengan ukuran lebih kecil.":e.message.includes("format")?t+="Format foto tidak didukung.":e.message.includes("PNG")?t+="Format PNG mungkin tidak didukung. Coba gunakan format JPG.":t+=e.message||"Terjadi kesalahan yang tidak diketahui.",this.showError("general",t),this.element.scrollIntoView({behavior:"smooth",block:"start"})}},{key:"resetForm",value:function(){this.element.querySelector("#add-s-frm").reset(),this.element.querySelector("#file-prv").classList.add("is-hidden"),this.element.querySelector("#file-upl-area").classList.remove("is-hidden"),this.element.querySelector("#camera-prv-result").classList.add("is-hidden"),this.element.querySelector(".cam-cntnr").classList.remove("is-hidden"),this.currentLat=null,this.currentLon=null,this.element.querySelector("#latitude-display").textContent="-",this.element.querySelector("#longitude-display").textContent="-",this.currentPhoto=null,this.hideError("description"),this.hideError("photo"),this.hideError("location"),this.hideError("general"),this.stopCamera(),this.updateSubmitButton()}},{key:"cleanupSelectionMarker",value:function(){this.mapManager&&this.mapManager.map&&this.selectionMarker&&(this.mapManager.map.removeLayer(this.selectionMarker),this.selectionMarker=null)}},{key:"destroy",value:function(){this.stopCamera(),this.cleanupSelectionMarker(),this.mapManager&&(this.mapManager.destroy(),this.mapManager=null)}}],t&&y(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,a,s,c,l,u,d}()}}]);